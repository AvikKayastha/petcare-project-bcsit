<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Comaptiable" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="shortcut icon" type="x-icon" href="/photos/pet-care_logo_1.png">
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link href="login_page.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="form-box login">
            <form action="api/login" method="post">
                <div class="input-box">
                    <input type="email" placeholder="Email" name="email" required>
                    <i class='bx  bx-user'></i>
                </div>
                <div class="input-box">
                    <input type="password" placeholder="Password" name="password" required>
                    <i class='bx  bx-lock'></i>
                </div>
                <button type="submit" class="btn">Login</button>
                <div class="forgot-link">
                    <a href="#">Forgot Password?</a>
                </div>
            </form>
        </div>
        <div class="form-box register">
            <form id="registerForm" action="/api/create" method="POST">
                <h1>Registration</h1>
                <div class="input-box">
                    <input type="text" placeholder="Username" name="name" required>
                    <i class='bx  bx-user'></i>
                </div>
                <div class="input-box">
                    <input type="email" placeholder="Enter your Email" name="email" required>
                    <i class='bx  bx-envelope'></i>
                </div>
                <div class="input-box">
                    <input type="password" placeholder="Create a new Password" name="password" required>
                    <i class='bx  bx-lock'></i>
                </div>
                <div class="input-box">
                    <input type="password" placeholder="Confirm Password" name="cpassword" required>
                    <i class='bx  bx-lock'></i>
                </div>
                <div class="role-section">
                    <div class="role-title">Select Role:</div>

                    <div class="role-options">
                        <label>
                            <input type="radio" name="role" value="owner" required> Pet Owner
                        </label>
                        <label>
                            <input type="radio" name="role" value="caretaker"> Pet Caretaker
                        </label>
                    </div>
                </div>
                <div class="error" id="errorMessage"></div>
                <button type="submit" class="btn">Register</button>
            </form>
        </div>
        <div class="toggle-box">
            <div class="toggle-panel toggle-left">
                <h1>Hello, Welcome:)</h1><br>
                <p>Don't have an account?</p>
                <button class="btn register-btn">Register</button>
            </div>
            <div class="toggle-panel toggle-right">
                <h1> Welcome back!</h1><br>
                <p>Already have an account?</p>
                <button class="btn login-btn">Login</button>
            </div>
        </div>
    </div>
    <script>
        const container = document.querySelector('.container');
        const registerBtn = document.querySelector('.register-btn');
        const loginBtn = document.querySelector('.login-btn');

        registerBtn.addEventListener('click', () => {
            container.classList.add('active');
        });

        loginBtn.addEventListener('click', () => {
            container.classList.remove('active');
        });

        function showToast(message, isError = false) {
  const toast = document.getElementById("toast");
  toast.innerText = message;
  toast.style.backgroundColor = isError ? "#d9534f" : "#4BB543";
  toast.classList.add("show");

  setTimeout(() => {
    toast.classList.remove("show");
  }, 3000); // disappears after 3s
}

        
    const registerForm = document.querySelector('.form-box.register form');

    registerForm.addEventListener('submit', async function (e) {
    e.preventDefault();

    const formData = new FormData(registerForm);
    const data = Object.fromEntries(formData.entries());

  try {
    const res = await fetch('/api/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });

    const result = await res.text();

    if (res.status === 201) {
        showToast(result, false); // ✅ success
        registerForm.reset();
        container.classList.remove('active'); // switch to login view
    } else {
        showToast(result, true); // ❌ error
}

  }  catch (err) {
        showToast('Something went wrong', true);
        console.error(err);
  }
});


</script>

<div id="toast" class="toast">User created successfully</div>

</body>

</html>