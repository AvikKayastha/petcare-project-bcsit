<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Booking - PetCare</title>
    <link rel="shortcut icon" href="/photos/pet-care_logo_1.png" type="image/x-icon">
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link href="index.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <aside>
            <div class="top">
                <div class="logo">
                    <a href="/homepage"><h2>PET<span class="danger">CARE</span></h2></a>
                </div>
                <div class="close" id="close-btn">
                    <i class='bx bx-x'></i>
                </div>
            </div>
            <div class="sidebar">
                <a href="/user/user_dashboard">
                    <i class='bx bx-home'></i>
                    <h3>Dashboard</h3>
                </a>
                <a href="/user/user_profile">
                    <i class='bx bx-calendar'></i>
                    <h3>My Profile</h3>
                </a>
                <a href="/user/user_booking" class="active">
                    <i class='bx bx-calendar'></i>
                    <h3>My Bookings</h3>
                </a>
                <a href="/user/user_payment">
                    <i class='bx bx-calendar'></i>
                    <h3>My Payments</h3>
                </a>
                <a href="/user/user_message">
                    <i class='bx bx-message'></i>
                    <h3>Messages</h3>
                    <span class="message-count">8</span>
                </a>
                <a href="#">
                    <i class='bx bx-log-out'></i>
                    <h3></h3>
                </a>
            </div>
        </aside>

        <main>
        <h1>My Bookings</h1>
        <div class="recent-orders">
        <h2>Upcoming & Past Bookings</h2>

    <!-- Loader -->
    <div id="loading" style="display: none; text-align: center; padding: 10px;">
        <p>Loading bookings...</p>
    </div>

    <!-- Error message -->
    <div id="error" style="display: none; color: red; text-align: center;">
        <p>Failed to load bookings. Please try again later.</p>
    </div>

    <!-- Bookings Table -->
    <table id="bookingsTable" style="display: none;">
        <thead>
            <tr>
                <th>Service</th>
                <th>Date</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="bookingsBody">
            <!-- Data will be loaded here from database -->
        </tbody>
    </table>

    <a href="#">View All Bookings</a>
</div>

    </main>
    </div>
<script> 
// Run this function when page loads
window.addEventListener('load', function () { 
    loadBookings(); 
});

// Function to fetch bookings from backend
function loadBookings() { 
    const loading = document.getElementById('loading'); 
    const error = document.getElementById('error'); 
    const table = document.getElementById('bookingsTable'); 
    
    if (loading) loading.style.display = 'block'; 
    if (table) table.style.display = 'none'; 
    if (error) error.style.display = 'none'; 
    
    // Fetch data from backend API
    fetch('/api/petwalk/user_booking') 
    .then(function (response) { 
        if (response.ok) { 
            return response.json(); 
        } else { 
            throw new Error('Failed to fetch bookings'); 
        } 
    }) 
    .then(function (data) { 
        console.log("✅ Bookings data:", data); 
        if (loading) loading.style.display = 'none'; 
        if (table) table.style.display = 'table'; 
        
        // Use the bookings array inside the data
        displayBookings(data.bookings); 
    }) 
    .catch(function (error) { 
        if (loading) loading.style.display = 'none'; 
        if (error) error.style.display = 'block'; 
        console.error('❌ Error loading bookings:', error); 
    }); 
}

// Function to display bookings in the table
function displayBookings(bookings) { 
    var tbody = document.getElementById('bookingsBody'); 
    tbody.innerHTML = ''; // Clear existing rows 
    
    // If no bookings found
    if (!bookings || bookings.length === 0) { 
        tbody.innerHTML = '<tr><td colspan="3" style="text-align: center;">No bookings found</td></tr>'; 
        return; 
    } 
    
    // Create table rows for each booking
    bookings.forEach(function (booking) { 
        var row = document.createElement('tr'); 
        row.innerHTML = '<td>' + booking.service + '</td>' + '<td>' + booking.date + '</td>' + '<td>' + booking.status + '</td>'; 
        tbody.appendChild(row); 
    }); 
}
</script>

   
</body>

</html>