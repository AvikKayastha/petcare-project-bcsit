<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - PetCare</title>
    <link rel="shortcut icon" href="/photos/pet-care_logo_1.png" type="image/x-icon">
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link href="index.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <aside>
            <div class="top">
                <div class="logo">
                    <a href="/homepage"><h2>PET<span class="danger">CARE</span></h2></a>
                </div>
                <div class="close" id="close-btn">
                    <i class='bx bx-x'></i>
                </div>
            </div>
            <div class="sidebar">
                <a href="/user/user_dashboard" class="active">
                    <i class='bx bx-home'></i>
                    <h3>Dashboard</h3>
                </a>
                <a href="/user/user_profile">
                    <i class='bx bx-calendar'></i>
                    <h3>My Profile</h3>
                </a>
                <a href="/user/user_booking">
                    <i class='bx bx-calendar'></i>
                    <h3>My Bookings</h3>
                </a>
                <a href="/user/user_payment">
                    <i class='bx bx-calendar'></i>
                    <h3>My Payments</h3>
                </a>
                <a href="/user/user_message">
                    <i class='bx bx-message'></i>
                    <h3>Messages</h3>
                    <span class="message-count">8</span>
                </a>
                <a href="#">
                    <i class='bx bx-log-out'></i>
                    <h3></h3>
                </a>
            </div>
        </aside>
        <!-- END OF ASIDE -->

        <main>
            <h1>Welcome Back!</h1>
            <div class="insights">
                <div class="upcoming-booking">
                    <i class='bx bx-calendar-check'></i>
                    <div class="middle">
                        <div class="left">
                            <h3>Upcoming Booking</h3>
                            <h1>Pet Veterinary Appointment</h1>
                        </div>
                    </div>
                    <small class="text-muted">In 2 days</small>
                </div>

                <div class="previous-visits">
                    <i class='bx bx-history'></i>
                    <div class="middle">
                        <div class="left">
                            <h3>Previous Visits</h3>
                            <h1>4</h1>
                        </div>
                    </div>
                    <small class="text-muted">In the last month</small>
                </div>

                <div class="pending-payments">
                    <i class='bx bx-credit-card'></i>
                    <div class="middle">
                        <div class="left">
                            <h3>Pending Payments</h3>
                            <h1>Rs 1,500</h1>
                        </div>
                    </div>
                    <small class="text-muted">Due soon</small>
                </div>
            </div>
            <!-- END OF INSIGHTS -->

            <div class="recent-orders"> <br>
                <h2>My Recent Bookings</h2>
                <table id="bookingsTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>Service</th>
                            <th>Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="bookingsBody">
            
                    </tbody>
                </table>
                <a href="/user/user_booking">View All Bookings</a>
            </div>
        </main>

        <!-- END OF MAIN -->

        <div class="right">
            <div class="top">
                <div class="profile">
                    <div class="info">
                        <p>Hey, <b>Kripa</b></p>
                        <small class="text-muted">Pet Owner</small>
                    </div>
                    <div class="profile-photo">
                        <img src="../images/profile-picture.png">
                    </div>
                </div>
            </div>

            <!-- END OF TOP -->

            <div class="recent-updates">
                <h2>Notifications</h2>
                <div class="updates">
                    <div class="update">
                        <div class="profile-photo">
                            <img src="../images/profile-picture.png">
                        </div>
                        <div class="message">
                            <p>Your Pet Grooming session is confirmed!</p>
                            <small class="text-muted">2 Minutes Ago</small>
                        </div>
                    </div>
                    
                    <div class="update">
                        <div class="profile-photo">
                            <img src="../images/profile-picture.png">
                        </div>
                        <div class="message">
                            <p>Vaccination reminder for your dog.</p>
                            <small class="text-muted">1 Day Ago</small>
                        </div>
                    </div>
                    <div class="update">
                        <div class="profile-photo">
                            <img src="../images/profile-picture.png">
                        </div>
                        <div class="message">
                            <p>Payment of Rs 1,500 is pending.</p>
                            <small class="text-muted">3 Days Ago</small>
                        </div>
                    </div>
                    
                    <div class="update">
                        <div class="profile-photo">
                            <img src="../images/profile-picture.png">
                        </div>
                        <div class="message">
                            <p>Your Pet Boarding session is Completed!</p>
                            <small class="text-muted"> 5 Days Ago</small>
                        </div>
                    </div>

                    <div class="update">
                        <div class="profile-photo">
                            <img src="../images/profile-picture.png">
                        </div>
                        <div class="message">
                            <p>Your Pet Grooming session is confirmed!</p>
                            <small class="text-muted">A Week Ago</small>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>
</body>
<script> 
// Run this function when page loads
window.addEventListener('load', function () { 
    loadBookings(); 
});

// Function to fetch bookings from backend
function loadBookings() { 
    const loading = document.getElementById('loading'); 
    const error = document.getElementById('error'); 
    const table = document.getElementById('bookingsTable'); 
    
    if (loading) loading.style.display = 'block'; 
    if (table) table.style.display = 'none'; 
    if (error) error.style.display = 'none'; 
    
    // Fetch data from backend API
    fetch('/api/petwalk/user_booking') 
    .then(function (response) { 
        if (response.ok) { 
            return response.json(); 
        } else { 
            throw new Error('Failed to fetch bookings'); 
        } 
    }) 
    .then(function (data) { 
        console.log("✅ Bookings data:", data); 
        if (loading) loading.style.display = 'none'; 
        if (table) table.style.display = 'table'; 
        
        // Use the bookings array inside the data
        displayBookings(data.bookings); 
    }) 
    .catch(function (error) { 
        if (loading) loading.style.display = 'none'; 
        if (error) error.style.display = 'block'; 
        console.error('❌ Error loading bookings:', error); 
    }); 
}

// Function to display bookings in the table
function displayBookings(bookings) { 
    var tbody = document.getElementById('bookingsBody'); 
    tbody.innerHTML = ''; // Clear existing rows 
    
    // If no bookings found
    if (!bookings || bookings.length === 0) { 
        tbody.innerHTML = '<tr><td colspan="3" style="text-align: center;">No bookings found</td></tr>'; 
        return; 
    } 
    
    // Create table rows for each booking
    bookings.forEach(function (booking) { 
        var row = document.createElement('tr'); 
        row.innerHTML = '<td>' + booking.service + '</td>' + '<td>' + booking.date + '</td>' + '<td>' + booking.status + '</td>'; 
        tbody.appendChild(row); 
    }); 
}
</script>

</html>